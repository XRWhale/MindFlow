<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindFlow - 상세</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#f7f7f8">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { "primary": "#121a31" },
                    fontFamily: { "display": ["Inter", "sans-serif"] },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
    </style>
</head>
<body class="bg-[#f7f7f8] text-[#121a31] min-h-screen flex flex-col items-center">

    <!-- Back bar -->
    <div class="w-full max-w-lg px-6 pt-6 pb-3">
        <a href="/home" class="inline-flex items-center gap-1 text-sm text-[#121a31]/60 hover:text-[#121a31] transition-colors">
            <span class="material-symbols-outlined text-lg">arrow_back</span>
            수집함으로
        </a>
    </div>

    <div id="content" class="w-full max-w-lg px-6 pb-28"></div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[calc(100%-3rem)] max-w-sm bg-[#121a31]/95 backdrop-blur-xl rounded-full shadow-2xl z-50 px-2 py-2">
        <div class="flex items-center justify-around">
            <a href="/" class="flex flex-col items-center justify-center p-3 rounded-full text-white/40 hover:text-white/70 transition-colors">
                <span class="material-symbols-outlined">home</span>
            </a>
            <a href="/home" class="flex flex-col items-center justify-center p-3 rounded-full text-white/40 hover:text-white/70 transition-colors">
                <span class="material-symbols-outlined">grid_view</span>
            </a>
            <a href="/report" class="flex flex-col items-center justify-center p-3 rounded-full text-white/40 hover:text-white/70 transition-colors">
                <span class="material-symbols-outlined">analytics</span>
            </a>
        </div>
    </nav>

    <script type="module">
        import { getItemById, incrementViewCount, escapeHtml, timeAgo, migrateItems } from '/js/storage.js';

        migrateItems();

        const container = document.getElementById('content');
        const params = new URLSearchParams(location.search);
        const id = params.get('id');

        if (!id) {
            location.replace('/home');
        }

        const item = getItemById(id);

        const INTENT_STYLES = {
            '영감': { bg: 'background:#FFF3E0', color: 'color:#E65100' },
            '배움': { bg: 'background:#E3F2FD', color: 'color:#1565C0' },
            '실행': { bg: 'background:#E8F5E9', color: 'color:#2E7D32' },
        };

        if (!item) {
            container.innerHTML = `
                <div class="text-center py-16 opacity-60">
                    <span class="material-symbols-outlined text-5xl block mb-4">search_off</span>
                    <p class="text-lg mb-3">콘텐츠를 찾을 수 없습니다</p>
                    <a href="/home" class="text-sm font-semibold text-[#121a31] underline underline-offset-2">수집함으로 돌아가기</a>
                </div>`;
        } else {
            incrementViewCount(id);
            renderDetail(item);
        }

        function renderDetail(item) {
            let html = '';

            // Thumbnail
            if (item.thumbnail) {
                html += `<img class="w-full max-h-72 object-cover rounded-2xl mb-4" src="${escapeHtml(item.thumbnail)}" alt="" onerror="this.style.display='none'">`;
            }

            // Main card
            html += '<div class="bg-white rounded-2xl border border-black/5 shadow-sm overflow-hidden">';
            html += '<div class="p-6">';

            // Title
            html += `<h1 class="text-2xl font-bold leading-tight mb-2">${escapeHtml(item.title) || '(제목 없음)'}</h1>`;

            // Source badge
            if (item.source) {
                const sourceLabels = {
                    instagram: 'Instagram', youtube: 'YouTube',
                    twitter: 'X (Twitter)', tiktok: 'TikTok', web: 'Web'
                };
                html += `<span class="inline-block text-xs text-[#121a31]/50 bg-[#121a31]/5 px-3 py-1 rounded-full mb-5">${sourceLabels[item.source] || item.source}</span>`;
            }

            // Summary
            if (item.summary) {
                html += '<div class="mb-5 pb-5 border-b border-black/5">';
                html += '<p class="text-xs font-bold text-[#121a31]/40 uppercase tracking-widest mb-2">요약</p>';
                html += `<p class="text-[#121a31]/80 text-base leading-relaxed">${escapeHtml(item.summary)}</p>`;
                html += '</div>';
            }

            // Category
            if (item.category) {
                html += '<div class="mb-5 pb-5 border-b border-black/5">';
                html += '<p class="text-xs font-bold text-[#121a31]/40 uppercase tracking-widest mb-2">카테고리</p>';
                html += `<span class="inline-block text-sm font-medium text-[#121a31]/70 bg-[#121a31]/5 px-3 py-1 rounded-full">${escapeHtml(item.category)}</span>`;
                html += '</div>';
            }

            // Tags
            if (item.tags && item.tags.length > 0) {
                html += '<div class="mb-5 pb-5 border-b border-black/5">';
                html += '<p class="text-xs font-bold text-[#121a31]/40 uppercase tracking-widest mb-2">태그</p>';
                html += '<div class="flex flex-wrap gap-2">';
                for (const tag of item.tags) {
                    html += `<span class="text-sm text-[#121a31]/60 bg-[#121a31]/[0.04] px-3 py-1 rounded-full">#${escapeHtml(tag)}</span>`;
                }
                html += '</div></div>';
            }

            // Intent
            if (item.intent) {
                const style = INTENT_STYLES[item.intent] || {};
                html += '<div class="mb-5 pb-5 border-b border-black/5">';
                html += '<p class="text-xs font-bold text-[#121a31]/40 uppercase tracking-widest mb-2">저장 의도</p>';
                html += `<div class="flex items-center gap-2">`;
                html += `<span class="inline-block px-3 py-1 rounded-full text-xs font-semibold" style="${style.bg || ''};${style.color || ''}">${escapeHtml(item.intent)}</span>`;
                html += `<span class="text-sm text-[#121a31]/60">목적으로 저장한 것으로 보여요</span>`;
                html += `</div></div>`;
            }

            // URL
            if (item.url) {
                html += '<div class="mb-4 pb-4 border-b border-black/5">';
                html += '<p class="text-xs font-bold text-[#121a31]/40 uppercase tracking-widest mb-2">원본 링크</p>';
                html += `<a href="${escapeHtml(item.url)}" target="_blank" class="text-sm text-blue-600 hover:underline break-all">${escapeHtml(item.url)}</a>`;
                html += '</div>';
            }

            // Time
            html += `<p class="text-xs text-[#121a31]/40">${timeAgo(item.createdAt)}</p>`;

            html += '</div></div>'; // p-6, card
            container.innerHTML = html;
        }
    </script>
</body>
</html>
